# Copyright 2010 Cecil Curry <leycec@gmail.com>
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'hamcrest-1.1.ebuild' from Gentoo, which is:
#     Copyright 1999-2010 Gentoo Foundation

require antefix install_aliases googlecode [ suffix=tgz ]
export_exlib_phases src_prepare

BUGS_TO="leycec@gmail.com"

SUMMARY="A framework for creating declarative matchers."
DESCRIPTION="
Hamcrest is a language-agnostic framework for creating matchers, allowing match
rules to be defined declaratively. These matchers have uses in unit testing
frameworks such as JUnit and jMock. (This is the Hamcrest Java port.)
"

UPSTREAM_DOCUMENTATION="http://code.google.com/p/${PN}/w/list [[ lang = en ]]"

SLOT="0"
LICENCES="BSD-3"
MYOPTIONS=""
DEPENDENCIES="
    build+run:
        dev-java/jarjar[>=0.6]
        dev-java/qdox[>=1.6.3]
        dev-java/xml-commons-external[>=1.3.4]
"

WORK="${WORKBASE}"/${PNV}

# Ant properties to be passed to all command-line invocations of Ant. This
# particular "build.xml" file complains with:
#
# [echo] The 'build.properties' file must be configured
#
# unless we pass it a "objectweb.ant.tasks.path" property having non-null
# value. We'll do it, but we won't like it.
ANT_PARAMS="-Dversion=${PV}"

ANT_SRC_PREPARE_SYMLINK_DIR=lib/generator
ANT_SRC_PREPARE_SYMLINK_JARS=( jarjar qdox )

ANT_SRC_COMPILE_PARAMS=( jarjar-1 )
ANT_SRC_INSTALL_PARAMS=( jar )

DEFAULT_SRC_INSTALL_EXTRA_DOCS=( README.txt CHANGES.txt )
ANT_SRC_INSTALL_JARS=( build/${PN}.jar )

hamcrest_src_prepare() {
    antefix_src_prepare

    # Hamcrest's "build.xml" file references version-specific jar files. Patch
    # the file, eliminating these references; and link in the jar files. Note,
    # the 'D' in "DPN" stands for dependency.
    einfo "Preparing build.xml and external dependencies..."
    for DPN in ${ANT_SRC_PREPARE_SYMLINK_JARS[@]}; do
      edo sed -e "s:${DPN}-\([0-9].\)*.jar::" -i 
    done
}

